openapi: 3.0.1
info:
  title: Carpark HDB (SG)
  description: |+
    This Data microservice retrieves the Singapore Housing Development Board's carpark information within Singapore HDB estates that includes location address, postal code and parking lot capacity for different types of vehicle by carpark location. 
    
    Updated monthly.
  x-description2 : |+
    **Search Types**  

    **Keyword search**  
    Keyword search; search for all searchable fields 
  version: '0.1'
servers:
  - url: 'https://api.sentient.io'
tags:
- name: "v0.1"
  description: "Published Date - Oct 10, 2019"
paths:
   /DaaS/prod/hdb/carpark:
    get:
      tags:
        - v0.1
      parameters:
        - in: query
          name: querystring
          schema:
            type: string
          description: keyword match to all searchable fields
          example: AK19
          x-required: false
        - in: query
          name: offset
          schema:
            type: integer
          description: The offset of the record list ie the starting index
          example: "0"
          x-required: false
        - in: query
          name: limit
          schema:
            type: integer
          description: The max records to return for the request. Default - 10, Max - 10000
          example: "10"
          x-required: false
        - in: query
          name: filterdata
          schema:
            type: string  
          description: |+
            Additional filter {"must":[ ],"should":[ ],"must_not":[ ],"filter":[ ]}
          x-required: false
          example: |+
            {  
            "must":[{"match_phrase":{"street":"ang+mo+kio+street+21"}}],  
            "filter":[{"match":{"tags.type":"source"}}] ,  
            "should":[{"match":{"source":"hdb"}}],  
            "must_not":[{"match":{"cpk_no":"AK19"}}  
            }
      responses:
        '200':
          description: success response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/success'
              example:
                results:
                  total: 38
                  max_score: 4.754334
                  hits:
                  - _index: sentient_carpark_hdb_index
                    _type: dir_doc
                    _id: BE16
                    _score: 4.754334
                    _source:
                      cpk_no: BE16
                      block: ''
                      street: BE16 BISHAN PARK I
                      address: " BE16 BISHAN PARK I"
                      source: hdb
                      xcoord: '28193.9043'
                      ycoord: '38482.8203'
                      car: 79
                      lorry: 19
                      mc: 0
                      createddate: '2020-09-11'
                      lastupdated: '2020-09-11'
                      location:
                        lat: 1.364299477060462
                        lon: 103.83506094142611
                message: Successfully Processed
                status: Success
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/unauthorized'
        '402':
          description: Payment Required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/paymentrequired'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/forbidden'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/notfound'
        '419':
          description: Input Field Missing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inputfieldmissing'
        '420':
          description: Input Limit Exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inputlimitexceeded'        
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/servererror'
        '504':
          description: Gateway Timeout
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/gatewaytimeout'
      security:
        - APIAuthorizer: []
components:
  schemas:
    success:
      type: object
      properties:
        results:
          type: object
          example: {<Json Object>}
          description: Json Object of returned results
          properties:
            total:
              type: number
              example: 986
              description: Total number of records
            max_score:
              type: number
              example: 17.995623
              description: The highest score value
            hits:
              type: array
              example: [{<JSON result Object}]
              description: The list of Json result object
              items:
                type: object
                properties:
                  _index:
                    type: string
                    description: Index group of the document
                    example: "sentient_carpark_hdb_index"
                  _type: 
                    type: string
                    description: Content type of the document
                    example: "dir_doc"
                  _id: 
                    type: string
                    description: Document ID
                    example: "K7scqWgBv3dNEHq2WvMo"
                  _score: 
                    type: string
                    description: The document score for the search request
                    example: 17.995623
                  _source: 
                    type: object
                    example: {<Json Object>}
                    description: Json Object of returned hits
                    properties:
                            cpk_no: 
                              type: string
                              description: Carpark Number
                              example: AK19
                            block: 
                              type: string
                              description: Shop block
                              example: "BLOCK 253"
                            street: 
                              type: string
                              description: Shop street or building name
                              example: "ANG MO KIO STREET 21"
                            address: 
                              type: string
                              description: Shop full address
                              example: "BLOCK 253 ANG MO KIO STREET 21"
                            source: 
                              type: string
                              description: Dataset source
                              example: "hdb"
                            postalcode: 
                              type: array
                              description: List of postal code
                              example: ["570253", "570254"]
                              items:
                                type: string
                                description: postal code
                                example: "570253"
                            xcoord:
                              type: string
                              description: SVY21 X coordinates
                              example: 28185.4359
                            ycoord:
                              type: string
                              description: SVY21 Y coordinates
                              example: 39012.6664
                            location:
                              type: object
                              description: WGS84 coordinates lat/long
                              example: {"lat":1.364299477060462,"lon":103.8350609414261}
                              properties:
                                  lat: 
                                    type: string
                                    description: WGS84 latitude
                                    example: 1.37179535
                                  lon:
                                    type: string
                                    description: WGS84 longitude
                                    example: 103.8469821
                            car:
                              type: string
                              description: Number of car parking lots
                              example: 18
                            lorry:
                              type: string
                              description: Number of lorry parking lots
                              example: 6
                            mc:
                              type: string
                              description: Number if mc parking lots
                              example: 0
                            createddate:
                              type: string
                              description: Record first release date on sentient
                              example: "2019-10-17"
                            lastupdated:
                              type: string
                              description: Record last updated date on sentient
                              example: "2019-10-17"
        message:
          type: string
          example: Successfully Processed
          description: The detail description on the status
        status:
          type: string
          example: Success
          description: The status of the API call Success/Failure
    unauthorized:
      type: object
      properties:
        message:
          type: string
          example: Missing Authentication Token
        status:
          type: string
          example: Failure
    forbidden:
      type: object
      properties:
        message:
          type: string
          example: Access Denied Unauthorized User
        status:
          type: string
          example: Failure
    paymentrequired:
      type: object
      properties:
        message:
          type: string
          example: Insufficient Credits Kindly Top Up
        status:
          type: string
          example: Failure
    notfound:
      type: object
      properties:
        message:
          type: string
          example: Invalid Request URL
        status:
          type: string
          example: Failure
    servererror:
      type: object
      properties:
        message:
          type: string
          example: Internal Server Error
        status:
          type: string
          example: Failure
    gatewaytimeout:
      type: object
      properties:
        message:
          type: string
          example: Request Timeout
        status:
          type: string
          example: Failure
    inputfieldmissing:
      type: object
      properties:
        message:
          type: string
          example: Input Field Missing
        status:
          type: string
          example: Failure
    inputlimitexceeded:
      type: object
      properties:
        message:
          type: string
          example: Input Limit Exceeded
        status:
          type: string
          example: Failure
    versions:
      type: object
      properties: 
        v0.1:
         type: array
         items:
          oneOf:
            - type: string
              example: Published Date - Oct 10,2019
              description: Initial version release
  securitySchemes:
    APIAuthorizer:
      type: apiKey
      name: x-api-key
      in: header
      x-amazon-apigateway-authtype: custom
      description: Authentication is done using the x-api-key in the request header.
